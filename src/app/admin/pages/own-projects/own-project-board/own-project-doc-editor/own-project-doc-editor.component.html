<div class="own-project-doc-editor-page" #docEditorPage [class.fullscreen-mode]="isFullscreen">
  <div class="editor-header" [formGroup]="form">
    <button type="button" class="back-btn" (click)="back()" matTooltip="Back to Docs">
      <mat-icon>arrow_back</mat-icon>
      <span>Docs</span>
    </button>
    <div class="header-title-wrap">
      <input
        type="text"
        class="header-doc-name-input"
        formControlName="name"
        placeholder="Doc name"
        maxlength="200"
      />
      <span class="header-doc-name-count">{{ form.get('name')?.value?.length || 0 }}/200</span>
    </div>
    <div class="header-actions">
      <button
        type="button"
        class="icon-btn"
        (click)="toggleFullscreen()"
        [matTooltip]="isFullscreen ? 'Exit fullscreen (Esc)' : 'Fullscreen'"
      >
        <mat-icon>{{ isFullscreen ? 'fullscreen_exit' : 'fullscreen' }}</mat-icon>
      </button>
      <button
        type="button"
        class="icon-btn"
        (click)="copyShareUrl()"
        [matTooltip]="isNewDoc ? 'Save doc first to copy link' : 'Copy share link'"
        [disabled]="isNewDoc"
      >
        <mat-icon>link</mat-icon>
      </button>
      <button
        type="button"
        class="icon-btn"
        (click)="downloadAsPdf()"
        [disabled]="isExporting"
        matTooltip="Download as PDF"
      >
        <mat-icon>picture_as_pdf</mat-icon>
      </button>
      <button
        type="button"
        class="icon-btn"
        (click)="downloadAsDoc()"
        [disabled]="isExporting"
        matTooltip="Download as Word (DOCX)"
      >
        <mat-icon>description</mat-icon>
      </button>
      <button
        class="save-btn"
        (click)="save()"
        [disabled]="isSaving || form.invalid"
        matTooltip="Save"
      >
        <mat-spinner *ngIf="isSaving" diameter="20"></mat-spinner>
        <mat-icon *ngIf="!isSaving">save</mat-icon>
        {{ isSaving ? 'Saving...' : 'Save' }}
      </button>
    </div>
  </div>

  <div class="loading-overlay" *ngIf="isLoading">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading doc...</p>
  </div>

  <div class="editor-body" [class.loading]="isLoading" [formGroup]="form">
    <div class="quill-wrapper">
      <quill-editor
        formControlName="content"
        [modules]="editorModules"
        [styles]="editorStyles"
        placeholder="Write your document here... You can use the toolbar for formatting and insert tables."
        class="quill-editor"
        (onEditorCreated)="onEditorCreated($event)"
      >
        <div above-quill-editor-toolbar class="table-toolbar-row">
          <button
            type="button"
            class="toolbar-btn table-btn"
            (click)="openInsertTableModal()"
            matTooltip="Insert table"
          >
            <mat-icon>table_chart</mat-icon>
            <span>Table</span>
          </button>
        </div>
      </quill-editor>
    </div>
  </div>

  <!-- In-component insert-table modal (shows in fullscreen because it's inside the page) -->
  <div class="insert-table-modal-overlay" *ngIf="showInsertTableModal" (click)="closeInsertTableModal()">
    <div class="insert-table-modal" (click)="$event.stopPropagation()">
      <h2 class="insert-table-modal-title">
        <mat-icon>table_chart</mat-icon>
        Insert table
      </h2>
      <div class="insert-table-modal-content">
        <div class="insert-table-fields">
          <label class="insert-table-field">
            <span class="insert-table-label">Rows</span>
            <input type="number" [(ngModel)]="insertTableRows" min="1" [max]="insertTableMaxRows" />
            <span class="insert-table-hint">1–{{ insertTableMaxRows }}</span>
          </label>
          <label class="insert-table-field">
            <span class="insert-table-label">Columns</span>
            <input type="number" [(ngModel)]="insertTableCols" min="1" [max]="insertTableMaxCols" />
            <span class="insert-table-hint">1–{{ insertTableMaxCols }}</span>
          </label>
        </div>
      </div>
      <div class="insert-table-modal-actions">
        <button type="button" class="insert-table-btn cancel" (click)="closeInsertTableModal()">Cancel</button>
        <button type="button" class="insert-table-btn primary" (click)="confirmInsertTable()">Insert</button>
      </div>
    </div>
  </div>
</div>
